<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>代码生成模板</title><link rel="preload" href="/comparison-note/_next/static/css/dc4eece8d63e31b4b040.css" as="style"/><link rel="stylesheet" href="/comparison-note/_next/static/css/dc4eece8d63e31b4b040.css" data-n-g=""/><link rel="preload" href="/comparison-note/_next/static/css/05437c60348a21355b6c.css" as="style"/><link rel="stylesheet" href="/comparison-note/_next/static/css/05437c60348a21355b6c.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/comparison-note/_next/static/chunks/main-14614ae8e939b9e5961e.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/framework.c7b20b4e446c7cca89e7.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/7945cc82.ff5578978733a40a67a3.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/commons.a32a113e095d8f0b1079.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/pages/_app-1832d2b05f1f19d6a06d.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/a1bc03cf.64f9f8493143216945e6.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/4d6c67b811e74d3ca6630b1db854b02fef4ff3ce.8a4303f940dd12850a8f.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/pages/%5B...param%5D-ec17b069b047a5ce78c3.js" as="script"/></head><body><div id="__next"><nav class="navbar navbar-expand-lg navbar-light bg-light"><a href="/comparison-note/" class="navbar-brand">对比学习笔记</a><button aria-controls="basic-navbar-nav" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="basic-navbar-nav"><div class="mr-auto navbar-nav"><a href="/comparison-note/algorithm" data-rb-event-key="/algorithm" class="nav-link">数据结构和算法</a><a href="/comparison-note/basic-concept" data-rb-event-key="/basic-concept" class="nav-link">基础概念</a><a href="/comparison-note/data-type" data-rb-event-key="/data-type" class="nav-link">数据类型</a><a href="/comparison-note/special" data-rb-event-key="/special" class="nav-link">专题</a></div></div></nav><div style="padding-top:12px;padding-bottom:12px" class="container-fluid"><h1>代码生成模板</h1><div style="margin-bottom:12px"><div class="markdown-body"></div></div><div style="margin-bottom:12px" class="justify-content-md-center row"><div class="col-md-auto"><div role="toolbar" class="btn-toolbar"><div role="group" class="btn-group btn-group-sm btn-group-toggle"><label class="btn btn-secondary"><input type="checkbox" value="go" autoComplete="off"/>go</label></div></div></div></div><div class="card-group"></div></div><div style="text-align:center;padding:12px 0;font-size:14px">v<!-- -->0.1.0<!-- --> <a href="https://github.com/fishjar/comparison-note" title="访问github源码">github</a></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"nav":{"name":"template","fullPath":"/special/template","asPath":"/special/template","id":"%2Fspecial%2Ftemplate","parent":{"name":"special","fullPath":"/special","asPath":"/special","id":"%2Fspecial","readme":{"title":"专题","fullPath":"/special/README.md"}},"readme":{"title":"代码生成模板","fullPath":"/special/template/README.md"},"cards":[{"name":"go.md","baseName":"go","extName":".md","fullPath":"/special/template/go.md"}],"nodes":[]},"content":"","cards":[{"name":"go.md","baseName":"go","extName":".md","fullPath":"/special/template/go.md","content":"取名为 container.tmp.go 放在 ./template/下\n\n- PACKAGE_NAME – 包名\n- GENERIC_NAME – 名字\n- GENERIC_TYPE – 实际的类型\n\n```go\npackage PACKAGE_NAME\ntype GENERIC_NAMEContainer struct {\n    s []GENERIC_TYPE\n}\nfunc NewGENERIC_NAMEContainer() *GENERIC_NAMEContainer {\n    return \u0026GENERIC_NAMEContainer{s: []GENERIC_TYPE{}}\n}\nfunc (c *GENERIC_NAMEContainer) Put(val GENERIC_TYPE) {\n    c.s = append(c.s, val)\n}\nfunc (c *GENERIC_NAMEContainer) Get() GENERIC_TYPE {\n    r := c.s[0]\n    c.s = c.s[1:]\n    return r\n}\n```\n\n一个叫 gen.sh 的生成脚本\n\n```sh\n#!/bin/bash\n\nset -e\n\nSRC_FILE=${1}\nPACKAGE=${2}\nTYPE=${3}\nDES=${4}\n#uppcase the first char\nPREFIX=\"$(tr '[:lower:]' '[:upper:]' \u003c\u003c\u003c ${TYPE:0:1})${TYPE:1}\"\n\nDES_FILE=$(echo ${TYPE}| tr '[:upper:]' '[:lower:]')_${DES}.go\n\nsed 's/PACKAGE_NAME/'\"${PACKAGE}\"'/g' ${SRC_FILE} | \\\n    sed 's/GENERIC_TYPE/'\"${TYPE}\"'/g' | \\\n    sed 's/GENERIC_NAME/'\"${PREFIX}\"'/g' \u003e ${DES_FILE}\n```\n\n在代码中打一个特殊的注释\n\n- 第一个注释是生成包名为 gen 类型为 uint32 目标文件名以 container 为后缀\n- 第二个注释是生成包名为 gen 类型为 string 目标文件名以 container 为后缀\n\n```go\n//go:generate ./gen.sh ./template/container.tmp.go gen uint32 container\nfunc generateUint32Example() {\n    var u uint32 = 42\n    c := NewUint32Container()\n    c.Put(u)\n    v := c.Get()\n    fmt.Printf(\"generateExample: %d (%T)\\n\", v, v)\n}\n\n//go:generate ./gen.sh ./template/container.tmp.go gen string container\nfunc generateStringExample() {\n    var s string = \"Hello\"\n    c := NewStringContainer()\n    c.Put(s)\n    v := c.Get()\n    fmt.Printf(\"generateExample: %s (%T)\\n\", v, v)\n}\n```\n\n在工程目录中直接执行 `go generate` 命令，就会生成如下两份代码\n\n```go\n// uint32_container.go\npackage gen\n\ntype Uint32Container struct {\n    s []uint32\n}\nfunc NewUint32Container() *Uint32Container {\n    return \u0026Uint32Container{s: []uint32{}}\n}\nfunc (c *Uint32Container) Put(val uint32) {\n    c.s = append(c.s, val)\n}\nfunc (c *Uint32Container) Get() uint32 {\n    r := c.s[0]\n    c.s = c.s[1:]\n    return r\n}\n```\n\n```go\n// string_container.go\npackage gen\n\ntype StringContainer struct {\n    s []string\n}\nfunc NewStringContainer() *StringContainer {\n    return \u0026StringContainer{s: []string{}}\n}\nfunc (c *StringContainer) Put(val string) {\n    c.s = append(c.s, val)\n}\nfunc (c *StringContainer) Get() string {\n    r := c.s[0]\n    c.s = c.s[1:]\n    return r\n}\n```\n"}]}},"page":"/[...param]","query":{"param":["special","template"]},"buildId":"S-jJrz2DKYE9I2Mqo2Xou","assetPrefix":"/comparison-note","nextExport":true,"isFallback":false,"gip":true,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"charSet":"utf-8"}],["title",{"children":"代码生成模板"}]]}</script><script nomodule="" src="/comparison-note/_next/static/chunks/polyfills-7258ef49cf482e03ae9c.js"></script><script src="/comparison-note/_next/static/chunks/main-14614ae8e939b9e5961e.js" async=""></script><script src="/comparison-note/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/comparison-note/_next/static/chunks/framework.c7b20b4e446c7cca89e7.js" async=""></script><script src="/comparison-note/_next/static/chunks/7945cc82.ff5578978733a40a67a3.js" async=""></script><script src="/comparison-note/_next/static/chunks/commons.a32a113e095d8f0b1079.js" async=""></script><script src="/comparison-note/_next/static/chunks/pages/_app-1832d2b05f1f19d6a06d.js" async=""></script><script src="/comparison-note/_next/static/chunks/a1bc03cf.64f9f8493143216945e6.js" async=""></script><script src="/comparison-note/_next/static/chunks/4d6c67b811e74d3ca6630b1db854b02fef4ff3ce.8a4303f940dd12850a8f.js" async=""></script><script src="/comparison-note/_next/static/chunks/pages/%5B...param%5D-ec17b069b047a5ce78c3.js" async=""></script><script src="/comparison-note/_next/static/S-jJrz2DKYE9I2Mqo2Xou/_buildManifest.js" async=""></script><script src="/comparison-note/_next/static/S-jJrz2DKYE9I2Mqo2Xou/_ssgManifest.js" async=""></script></body></html>