<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Options 配置选项</title><link rel="preload" href="/comparison-note/_next/static/css/dc4eece8d63e31b4b040.css" as="style"/><link rel="stylesheet" href="/comparison-note/_next/static/css/dc4eece8d63e31b4b040.css" data-n-g=""/><link rel="preload" href="/comparison-note/_next/static/css/05437c60348a21355b6c.css" as="style"/><link rel="stylesheet" href="/comparison-note/_next/static/css/05437c60348a21355b6c.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/comparison-note/_next/static/chunks/main-14614ae8e939b9e5961e.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/framework.c7b20b4e446c7cca89e7.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/7945cc82.ff5578978733a40a67a3.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/commons.a32a113e095d8f0b1079.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/pages/_app-1832d2b05f1f19d6a06d.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/a1bc03cf.64f9f8493143216945e6.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/4d6c67b811e74d3ca6630b1db854b02fef4ff3ce.8a4303f940dd12850a8f.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/pages/%5B...param%5D-ec17b069b047a5ce78c3.js" as="script"/></head><body><div id="__next"><nav class="navbar navbar-expand-lg navbar-light bg-light"><a href="/comparison-note/" class="navbar-brand">对比学习笔记</a><button aria-controls="basic-navbar-nav" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="basic-navbar-nav"><div class="mr-auto navbar-nav"><a href="/comparison-note/algorithm" data-rb-event-key="/algorithm" class="nav-link">数据结构和算法</a><a href="/comparison-note/basic-concept" data-rb-event-key="/basic-concept" class="nav-link">基础概念</a><a href="/comparison-note/data-type" data-rb-event-key="/data-type" class="nav-link">数据类型</a><a href="/comparison-note/special" data-rb-event-key="/special" class="nav-link">专题</a></div></div></nav><div style="padding-top:12px;padding-bottom:12px" class="container-fluid"><h1>Options 配置选项</h1><div style="margin-bottom:12px"><div class="markdown-body"></div></div><div style="margin-bottom:12px" class="justify-content-md-center row"><div class="col-md-auto"><div role="toolbar" class="btn-toolbar"><div role="group" class="btn-group btn-group-sm btn-group-toggle"><label class="btn btn-secondary"><input type="checkbox" value="go" autoComplete="off"/>go</label></div></div></div></div><div class="card-group"></div></div><div style="text-align:center;padding:12px 0;font-size:14px">v<!-- -->0.1.0<!-- --> <a href="https://github.com/fishjar/comparison-note" title="访问github源码">github</a></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"nav":{"name":"options","fullPath":"/special/functional/options","asPath":"/special/functional/options","id":"%2Fspecial%2Ffunctional%2Foptions","parent":{"name":"functional","fullPath":"/special/functional","asPath":"/special/functional","id":"%2Fspecial%2Ffunctional","readme":{"title":"函数式编程","fullPath":"/special/functional/README.md"}},"readme":{"title":"Options 配置选项","fullPath":"/special/functional/options/README.md"},"cards":[{"name":"go.md","baseName":"go","extName":".md","fullPath":"/special/functional/options/go.md"}],"nodes":[]},"content":"","cards":[{"name":"go.md","baseName":"go","extName":".md","fullPath":"/special/functional/options/go.md","content":"## builder 模式\n\n```go\n// 需要配置的结构体\ntype Server struct {\n    Addr     string\n    Port     int\n    Protocol string\n    Timeout  time.Duration\n    MaxConns int\n    TLS      *tls.Config\n}\n\n//使用一个builder类来做包装\ntype ServerBuilder struct {\n    Server\n}\n\nfunc (sb *ServerBuilder) Create(addr string, port int) *ServerBuilder {\n    sb.Server.Addr = addr\n    sb.Server.Port = port\n    //其它代码设置其它成员的默认值\n    return sb\n}\n\nfunc (sb *ServerBuilder) WithProtocol(protocol string) *ServerBuilder {\n    sb.Server.Protocol = protocol\n    return sb\n}\n\nfunc (sb *ServerBuilder) WithMaxConn( maxconn int) *ServerBuilder {\n    sb.Server.MaxConns = maxconn\n    return sb\n}\n\nfunc (sb *ServerBuilder) WithTimeOut( timeout time.Duration) *ServerBuilder {\n    sb.Server.Timeout = timeout\n    return sb\n}\n\nfunc (sb *ServerBuilder) WithTLS( tls *tls.Config) *ServerBuilder {\n    sb.Server.TLS = tls\n    return sb\n}\n\nfunc (sb *ServerBuilder) Build() (Server) {\n    return  sb.Server\n}\n\n\nsb := ServerBuilder{}\nserver, err := sb.Create(\"127.0.0.1\", 8080).\n    WithProtocol(\"udp\").\n    WithMaxConn(1024).\n    WithTimeOut(30*time.Second).\n    Build()\n```\n\n## Functional Options (利用高阶函数/闭包)\n\n```go\n// 需要配置的结构体\ntype Server struct {\n    Addr     string\n    Port     int\n    Protocol string\n    Timeout  time.Duration\n    MaxConns int\n    TLS      *tls.Config\n}\n\n// 先定义一个函数类型\ntype Option func(*Server)\n\n// 使用函数式的方式定义一组如下的函数\n// 返回的这个函数会设置自己的 Server 参数\nfunc Protocol(p string) Option {\n    return func(s *Server) {\n        s.Protocol = p\n    }\n}\nfunc Timeout(timeout time.Duration) Option {\n    return func(s *Server) {\n        s.Timeout = timeout\n    }\n}\nfunc MaxConns(maxconns int) Option {\n    return func(s *Server) {\n        s.MaxConns = maxconns\n    }\n}\nfunc TLS(tls *tls.Config) Option {\n    return func(s *Server) {\n        s.TLS = tls\n    }\n}\n\n// 使用一个for-loop来设置我们的 Server 对象\nfunc NewServer(addr string, port int, options ...func(*Server)) (*Server, error) {\n    srv := Server{\n        Addr:     addr,\n        Port:     port,\n        Protocol: \"tcp\",\n        Timeout:  30 * time.Second,\n        MaxConns: 1000,\n        TLS:      nil,\n    }\n    for _, option := range options {\n        option(\u0026srv)\n    }\n    //...\n    return \u0026srv, nil\n}\n\n// 创建 Server 对象\ns1, _ := NewServer(\"localhost\", 1024)\ns2, _ := NewServer(\"localhost\", 2048, Protocol(\"udp\"))\ns3, _ := NewServer(\"0.0.0.0\", 8080, Timeout(300*time.Second), MaxConns(1000))\n```\n\n## Functional Options (UBER)\n\n```go\n// 需要配置的结构体\ntype options struct {\n    cache  bool\n    logger *zap.Logger\n}\n\n// 定义接口\ntype Option interface {\n    apply(*options)\n}\n\n// 定义配置选项类型\ntype cacheOption bool\nfunc (c cacheOption) apply(opts *options) {\n    opts.cache = bool(c)\n}\nfunc WithCache(c bool) Option {\n    return cacheOption(c)\n}\n\n// 定义配置选项类型\ntype loggerOption struct {\n    Log *zap.Logger\n}\nfunc (l loggerOption) apply(opts *options) {\n    opts.logger = l.Log\n}\nfunc WithLogger(log *zap.Logger) Option {\n    return loggerOption{Log: log}\n}\n\n// Open creates a connection.\nfunc Open(\n    addr string,\n    opts ...Option,\n) (*Connection, error) {\n    options := options{\n        cache:  defaultCache,\n        logger: zap.NewNop(),\n    }\n\n    for _, o := range opts {\n        o.apply(\u0026options)\n    }\n\n    // ...\n}\n\n// 使用\nc, _ := Open(\"localhost\", WithCache(true), WithLogger(\u0026zap.NewNop()))\n```\n"}]}},"page":"/[...param]","query":{"param":["special","functional","options"]},"buildId":"S-jJrz2DKYE9I2Mqo2Xou","assetPrefix":"/comparison-note","nextExport":true,"isFallback":false,"gip":true,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"charSet":"utf-8"}],["title",{"children":"Options 配置选项"}]]}</script><script nomodule="" src="/comparison-note/_next/static/chunks/polyfills-7258ef49cf482e03ae9c.js"></script><script src="/comparison-note/_next/static/chunks/main-14614ae8e939b9e5961e.js" async=""></script><script src="/comparison-note/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/comparison-note/_next/static/chunks/framework.c7b20b4e446c7cca89e7.js" async=""></script><script src="/comparison-note/_next/static/chunks/7945cc82.ff5578978733a40a67a3.js" async=""></script><script src="/comparison-note/_next/static/chunks/commons.a32a113e095d8f0b1079.js" async=""></script><script src="/comparison-note/_next/static/chunks/pages/_app-1832d2b05f1f19d6a06d.js" async=""></script><script src="/comparison-note/_next/static/chunks/a1bc03cf.64f9f8493143216945e6.js" async=""></script><script src="/comparison-note/_next/static/chunks/4d6c67b811e74d3ca6630b1db854b02fef4ff3ce.8a4303f940dd12850a8f.js" async=""></script><script src="/comparison-note/_next/static/chunks/pages/%5B...param%5D-ec17b069b047a5ce78c3.js" async=""></script><script src="/comparison-note/_next/static/S-jJrz2DKYE9I2Mqo2Xou/_buildManifest.js" async=""></script><script src="/comparison-note/_next/static/S-jJrz2DKYE9I2Mqo2Xou/_ssgManifest.js" async=""></script></body></html>