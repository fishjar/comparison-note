<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>字符串拼接</title><link rel="preload" href="/comparison-note/_next/static/css/dc4eece8d63e31b4b040.css" as="style"/><link rel="stylesheet" href="/comparison-note/_next/static/css/dc4eece8d63e31b4b040.css" data-n-g=""/><link rel="preload" href="/comparison-note/_next/static/css/05437c60348a21355b6c.css" as="style"/><link rel="stylesheet" href="/comparison-note/_next/static/css/05437c60348a21355b6c.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/comparison-note/_next/static/chunks/main-14614ae8e939b9e5961e.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/framework.c7b20b4e446c7cca89e7.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/7945cc82.ff5578978733a40a67a3.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/commons.a32a113e095d8f0b1079.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/pages/_app-1832d2b05f1f19d6a06d.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/a1bc03cf.64f9f8493143216945e6.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/4d6c67b811e74d3ca6630b1db854b02fef4ff3ce.8a4303f940dd12850a8f.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/pages/%5B...param%5D-ec17b069b047a5ce78c3.js" as="script"/></head><body><div id="__next"><nav class="navbar navbar-expand-lg navbar-light bg-light"><a href="/comparison-note/" class="navbar-brand">对比学习笔记</a><button aria-controls="basic-navbar-nav" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="basic-navbar-nav"><div class="mr-auto navbar-nav"><a href="/comparison-note/algorithm" data-rb-event-key="/algorithm" class="nav-link">数据结构和算法</a><a href="/comparison-note/basic-concept" data-rb-event-key="/basic-concept" class="nav-link">基础概念</a><a href="/comparison-note/data-type" data-rb-event-key="/data-type" class="nav-link">数据类型</a><a href="/comparison-note/special" data-rb-event-key="/special" class="nav-link">专题</a></div></div></nav><div style="padding-top:12px;padding-bottom:12px" class="container-fluid"><h1>字符串拼接</h1><div style="margin-bottom:12px"><div class="markdown-body"></div></div><div style="margin-bottom:12px" class="justify-content-md-center row"><div class="col-md-auto"><div role="toolbar" class="btn-toolbar"><div role="group" class="btn-group btn-group-sm btn-group-toggle"><label class="btn btn-secondary"><input type="checkbox" value="go" autoComplete="off"/>go</label></div></div></div></div><div class="card-group"></div></div><div style="text-align:center;padding:12px 0;font-size:14px">v<!-- -->0.1.0<!-- --> <a href="https://github.com/fishjar/comparison-note" title="访问github源码">github</a></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"nav":{"name":"string-concat","fullPath":"/data-type/string/string-concat","asPath":"/data-type/string/string-concat","id":"%2Fdata-type%2Fstring%2Fstring-concat","parent":{"name":"string","fullPath":"/data-type/string","asPath":"/data-type/string","id":"%2Fdata-type%2Fstring","readme":{"title":"字符串","fullPath":"/data-type/string/README.md"}},"readme":{"title":"字符串拼接","fullPath":"/data-type/string/string-concat/README.md"},"cards":[{"name":"go.md","baseName":"go","extName":".md","fullPath":"/data-type/string/string-concat/go.md"}],"nodes":[]},"content":"","cards":[{"name":"go.md","baseName":"go","extName":".md","fullPath":"/data-type/string/string-concat/go.md","content":"```go\npackage main\n\nimport (\n\t\"bytes\"\n\t\"fmt\"\n\t\"math/rand\"\n\t\"strings\"\n\t\"testing\"\n)\n\nconst letterBytes = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n\nfunc randomString(n int) string {\n\tb := make([]byte, n)\n\tfor i := range b {\n\t\tb[i] = letterBytes[rand.Intn(len(letterBytes))]\n\t}\n\treturn string(b)\n}\n\n// 使用 + 号\nfunc plusConcat(n int, str string) string {\n\ts := \"\"\n\tfor i := 0; i \u003c n; i++ {\n\t\ts += str\n\t}\n\treturn s\n}\n\n// 使用 fmt.Sprintf\nfunc sprintfConcat(n int, str string) string {\n\ts := \"\"\n\tfor i := 0; i \u003c n; i++ {\n\t\ts = fmt.Sprintf(\"%s%s\", s, str)\n\t}\n\treturn s\n}\n\n// 使用 strings.Builder\nfunc builderConcat(n int, str string) string {\n\tvar builder strings.Builder\n\tfor i := 0; i \u003c n; i++ {\n\t\tbuilder.WriteString(str)\n\t}\n\treturn builder.String()\n}\n\n// 最优方式\n// 使用 strings.Builder，预分配内存的方式 Grow\nfunc preBuilderConcat(n int, str string) string {\n\tvar builder strings.Builder\n\tbuilder.Grow(n * len(str))\n\tfor i := 0; i \u003c n; i++ {\n\t\tbuilder.WriteString(str)\n\t}\n\treturn builder.String()\n}\n\n// 使用 bytes.Buffer\nfunc bufferConcat(n int, s string) string {\n\tbuf := new(bytes.Buffer)\n\tfor i := 0; i \u003c n; i++ {\n\t\tbuf.WriteString(s)\n\t}\n\treturn buf.String()\n}\n\n// 使用 []byte\nfunc byteConcat(n int, str string) string {\n\tbuf := make([]byte, 0)\n\tfor i := 0; i \u003c n; i++ {\n\t\tbuf = append(buf, str...)\n\t}\n\treturn string(buf)\n}\n\n// 使用 []byte，预分配切片的容量(cap)\nfunc preByteConcat(n int, str string) string {\n\tbuf := make([]byte, 0, n*len(str))\n\tfor i := 0; i \u003c n; i++ {\n\t\tbuf = append(buf, str...)\n\t}\n\treturn string(buf)\n}\n\nfunc benchmark(b *testing.B, f func(int, string) string) {\n\tvar str = randomString(10)\n\tfor i := 0; i \u003c b.N; i++ {\n\t\tf(10000, str)\n\t}\n}\n\nfunc BenchmarkPlusConcat(b *testing.B)       { benchmark(b, plusConcat) }\nfunc BenchmarkSprintfConcat(b *testing.B)    { benchmark(b, sprintfConcat) }\nfunc BenchmarkBuilderConcat(b *testing.B)    { benchmark(b, builderConcat) }\nfunc BenchmarkPreBuilderConcat(b *testing.B) { benchmark(b, preBuilderConcat) }\nfunc BenchmarkBufferConcat(b *testing.B)     { benchmark(b, bufferConcat) }\nfunc BenchmarkByteConcat(b *testing.B)       { benchmark(b, byteConcat) }\nfunc BenchmarkPreByteConcat(b *testing.B)    { benchmark(b, preByteConcat) }\n```\n\n```sh\ngo test -bench=\"Concat$\" -benchmem .\ngoos: linux\ngoarch: amd64\npkg: demo\ncpu: AMD Ryzen 5 3500X 6-Core Processor             \nBenchmarkPlusConcat-6                 25          50676691 ns/op        530997136 B/op     10016 allocs/op\nBenchmarkSprintfConcat-6              12          95763922 ns/op        833576833 B/op     37388 allocs/op\nBenchmarkBuilderConcat-6            9614            107031 ns/op          514801 B/op         23 allocs/op\nBenchmarkPreBuilderConcat-6        21030             56843 ns/op          106496 B/op          1 allocs/op\nBenchmarkBufferConcat-6             9000            129491 ns/op          423536 B/op         13 allocs/op\nBenchmarkByteConcat-6              11332            106953 ns/op          621298 B/op         24 allocs/op\nBenchmarkPreByteConcat-6           19999             58401 ns/op          212992 B/op          2 allocs/op\nPASS\nok      demo    10.523s\n```\n"}]}},"page":"/[...param]","query":{"param":["data-type","string","string-concat"]},"buildId":"S-jJrz2DKYE9I2Mqo2Xou","assetPrefix":"/comparison-note","nextExport":true,"isFallback":false,"gip":true,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"charSet":"utf-8"}],["title",{"children":"字符串拼接"}]]}</script><script nomodule="" src="/comparison-note/_next/static/chunks/polyfills-7258ef49cf482e03ae9c.js"></script><script src="/comparison-note/_next/static/chunks/main-14614ae8e939b9e5961e.js" async=""></script><script src="/comparison-note/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/comparison-note/_next/static/chunks/framework.c7b20b4e446c7cca89e7.js" async=""></script><script src="/comparison-note/_next/static/chunks/7945cc82.ff5578978733a40a67a3.js" async=""></script><script src="/comparison-note/_next/static/chunks/commons.a32a113e095d8f0b1079.js" async=""></script><script src="/comparison-note/_next/static/chunks/pages/_app-1832d2b05f1f19d6a06d.js" async=""></script><script src="/comparison-note/_next/static/chunks/a1bc03cf.64f9f8493143216945e6.js" async=""></script><script src="/comparison-note/_next/static/chunks/4d6c67b811e74d3ca6630b1db854b02fef4ff3ce.8a4303f940dd12850a8f.js" async=""></script><script src="/comparison-note/_next/static/chunks/pages/%5B...param%5D-ec17b069b047a5ce78c3.js" async=""></script><script src="/comparison-note/_next/static/S-jJrz2DKYE9I2Mqo2Xou/_buildManifest.js" async=""></script><script src="/comparison-note/_next/static/S-jJrz2DKYE9I2Mqo2Xou/_ssgManifest.js" async=""></script></body></html>