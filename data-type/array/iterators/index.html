<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>迭代器</title><link rel="preload" href="/comparison-note/_next/static/css/dc4eece8d63e31b4b040.css" as="style"/><link rel="stylesheet" href="/comparison-note/_next/static/css/dc4eece8d63e31b4b040.css" data-n-g=""/><link rel="preload" href="/comparison-note/_next/static/css/05437c60348a21355b6c.css" as="style"/><link rel="stylesheet" href="/comparison-note/_next/static/css/05437c60348a21355b6c.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/comparison-note/_next/static/chunks/main-14614ae8e939b9e5961e.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/framework.c7b20b4e446c7cca89e7.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/7945cc82.ff5578978733a40a67a3.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/commons.a32a113e095d8f0b1079.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/pages/_app-1832d2b05f1f19d6a06d.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/a1bc03cf.64f9f8493143216945e6.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/4d6c67b811e74d3ca6630b1db854b02fef4ff3ce.8a4303f940dd12850a8f.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/pages/%5B...param%5D-ec17b069b047a5ce78c3.js" as="script"/></head><body><div id="__next"><nav class="navbar navbar-expand-lg navbar-light bg-light"><a href="/comparison-note/" class="navbar-brand">对比学习笔记</a><button aria-controls="basic-navbar-nav" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="basic-navbar-nav"><div class="mr-auto navbar-nav"><a href="/comparison-note/algorithm" data-rb-event-key="/algorithm" class="nav-link">数据结构和算法</a><a href="/comparison-note/basic-concept" data-rb-event-key="/basic-concept" class="nav-link">基础概念</a><a href="/comparison-note/data-type" data-rb-event-key="/data-type" class="nav-link">数据类型</a><a href="/comparison-note/special" data-rb-event-key="/special" class="nav-link">专题</a></div></div></nav><div style="padding-top:12px;padding-bottom:12px" class="container-fluid"><h1>迭代器</h1><div style="margin-bottom:12px"><div class="markdown-body"></div></div><div style="margin-bottom:12px" class="justify-content-md-center row"><div class="col-md-auto"><div role="toolbar" class="btn-toolbar"><div role="group" class="btn-group btn-group-sm btn-group-toggle"><label class="btn btn-secondary"><input type="checkbox" value="rust" autoComplete="off"/>rust</label></div></div></div></div><div class="card-group"></div></div><div style="text-align:center;padding:12px 0;font-size:14px">v<!-- -->0.1.0<!-- --> <a href="https://github.com/fishjar/comparison-note" title="访问github源码">github</a></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"nav":{"name":"iterators","fullPath":"/data-type/array/iterators","asPath":"/data-type/array/iterators","id":"%2Fdata-type%2Farray%2Fiterators","parent":{"name":"array","fullPath":"/data-type/array","asPath":"/data-type/array","id":"%2Fdata-type%2Farray","readme":{"title":"数组/列表/切片","fullPath":"/data-type/array/README.md"}},"readme":{"title":"迭代器","fullPath":"/data-type/array/iterators/README.md"},"cards":[{"name":"rust.md","baseName":"rust","extName":".md","fullPath":"/data-type/array/iterators/rust.md"}],"nodes":[]},"content":"","cards":[{"name":"rust.md","baseName":"rust","extName":".md","fullPath":"/data-type/array/iterators/rust.md","content":"迭代器（iterator）负责遍历序列中的每一项和决定序列何时结束的逻辑。当使用迭代器时，我们无需重新实现这些逻辑。\n\n在 Rust 中，迭代器是 惰性的（lazy），这意味着在调用方法使用迭代器之前它都不会有效果。\n\n```rust\nlet v1 = vec![1, 2, 3];\nlet v1_iter = v1.iter(); // 创建迭代器\nfor val in v1_iter {\n    println!(\"Got: {}\", val);\n}\n```\n\n迭代器都实现了一个叫做 Iterator 的定义于标准库的 trait\n\n```rust\npub trait Iterator {\n    type Item; // 定义了 trait 的 关联类型（associated type）\n    fn next(\u0026mut self) -\u003e Option\u003cSelf::Item\u003e;\n    // 此处省略了方法的默认实现\n}\n```\n\n- `iter` 方法生成一个不可变引用的迭代器。\n- 如果我们需要一个获取所有权并返回拥有所有权的迭代器，则可以调用 `into_iter` 而不是 iter。\n- 类似的，如果我们希望迭代可变引用，则可以调用 `iter_mut` 而不是 iter\n\n```rust\nfn iterator_demonstration() {\n    let v1 = vec![1, 2, 3];\n    // 注意 v1_iter 需要是可变的\n    // 使用 for 循环时无需使 v1_iter 可变\n    // 因为 for 循环会获取 v1_iter 的所有权并在后台使 v1_iter 可变。\n    let mut v1_iter = v1.iter();\n    // 调用迭代器的 next 方法\n    assert_eq!(v1_iter.next(), Some(\u00261));\n    assert_eq!(v1_iter.next(), Some(\u00262));\n    assert_eq!(v1_iter.next(), Some(\u00263));\n    assert_eq!(v1_iter.next(), None);\n}\n```\n\n## 消费迭代器\n\n```rust\nfn iterator_sum() {\n    let v1 = vec![1, 2, 3];\n    let v1_iter = v1.iter();\n    // next 方法的方法被称为 消费适配器（consuming adaptors）\n    // sum 方法也是\n    let total: i32 = v1_iter.sum();\n    assert_eq!(total, 6);\n}\n```\n\n## 产生其他迭代器\n\nIterator trait 中定义了另一类方法，被称为 迭代器适配器（iterator adaptors）\n\n```rust\nlet v1: Vec\u003ci32\u003e = vec![1, 2, 3];\n// 调用 map 方法创建一个新迭代器，\n// 接着调用 collect 方法消费新迭代器并创建一个 vector\nlet v2: Vec\u003c_\u003e = v1.iter().map(|x| x + 1).collect();\nassert_eq!(v2, vec![2, 3, 4]);\n```\n\n## 使用闭包\n\n```rust\n#[derive(PartialEq, Debug)]\nstruct Shoe {\n    size: u32,\n    style: String,\n}\n\nfn shoes_in_my_size(shoes: Vec\u003cShoe\u003e, shoe_size: u32) -\u003e Vec\u003cShoe\u003e {\n    shoes.into_iter()\n        .filter(|s| s.size == shoe_size)\n        .collect()\n}\n\n#[test]\nfn filters_by_size() {\n    let shoes = vec![\n        Shoe { size: 10, style: String::from(\"sneaker\") },\n        Shoe { size: 13, style: String::from(\"sandal\") },\n        Shoe { size: 10, style: String::from(\"boot\") },\n    ];\n    let in_my_size = shoes_in_my_size(shoes, 10);\n    assert_eq!(\n        in_my_size,\n        vec![\n            Shoe { size: 10, style: String::from(\"sneaker\") },\n            Shoe { size: 10, style: String::from(\"boot\") },\n        ]\n    );\n}\n```\n\n## 自定义迭代器\n\n```rust\nstruct Counter {\n    count: u32,\n}\n\nimpl Counter {\n    fn new() -\u003e Counter {\n        Counter { count: 0 }\n    }\n}\n\nimpl Iterator for Counter {\n    type Item = u32;\n\n    fn next(\u0026mut self) -\u003e Option\u003cSelf::Item\u003e {\n        self.count += 1;\n\n        if self.count \u003c 6 {\n            Some(self.count)\n        } else {\n            None\n        }\n    }\n}\n\n#[test]\nfn calling_next_directly() {\n    let mut counter = Counter::new();\n\n    assert_eq!(counter.next(), Some(1));\n    assert_eq!(counter.next(), Some(2));\n    assert_eq!(counter.next(), Some(3));\n    assert_eq!(counter.next(), Some(4));\n    assert_eq!(counter.next(), Some(5));\n    assert_eq!(counter.next(), None);\n}\n\n#[test]\nfn using_other_iterator_trait_methods() {\n    let sum: u32 = Counter::new()\n        .zip(Counter::new().skip(1))\n        .map(|(a, b)| a * b)\n        .filter(|x| x % 3 == 0)\n        .sum();\n    assert_eq!(18, sum);\n}\n```\n"}]}},"page":"/[...param]","query":{"param":["data-type","array","iterators"]},"buildId":"S-jJrz2DKYE9I2Mqo2Xou","assetPrefix":"/comparison-note","nextExport":true,"isFallback":false,"gip":true,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"charSet":"utf-8"}],["title",{"children":"迭代器"}]]}</script><script nomodule="" src="/comparison-note/_next/static/chunks/polyfills-7258ef49cf482e03ae9c.js"></script><script src="/comparison-note/_next/static/chunks/main-14614ae8e939b9e5961e.js" async=""></script><script src="/comparison-note/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/comparison-note/_next/static/chunks/framework.c7b20b4e446c7cca89e7.js" async=""></script><script src="/comparison-note/_next/static/chunks/7945cc82.ff5578978733a40a67a3.js" async=""></script><script src="/comparison-note/_next/static/chunks/commons.a32a113e095d8f0b1079.js" async=""></script><script src="/comparison-note/_next/static/chunks/pages/_app-1832d2b05f1f19d6a06d.js" async=""></script><script src="/comparison-note/_next/static/chunks/a1bc03cf.64f9f8493143216945e6.js" async=""></script><script src="/comparison-note/_next/static/chunks/4d6c67b811e74d3ca6630b1db854b02fef4ff3ce.8a4303f940dd12850a8f.js" async=""></script><script src="/comparison-note/_next/static/chunks/pages/%5B...param%5D-ec17b069b047a5ce78c3.js" async=""></script><script src="/comparison-note/_next/static/S-jJrz2DKYE9I2Mqo2Xou/_buildManifest.js" async=""></script><script src="/comparison-note/_next/static/S-jJrz2DKYE9I2Mqo2Xou/_ssgManifest.js" async=""></script></body></html>