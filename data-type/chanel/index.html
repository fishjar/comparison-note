<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>信道</title><link rel="preload" href="/comparison-note/_next/static/css/dc4eece8d63e31b4b040.css" as="style"/><link rel="stylesheet" href="/comparison-note/_next/static/css/dc4eece8d63e31b4b040.css" data-n-g=""/><link rel="preload" href="/comparison-note/_next/static/css/05437c60348a21355b6c.css" as="style"/><link rel="stylesheet" href="/comparison-note/_next/static/css/05437c60348a21355b6c.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/comparison-note/_next/static/chunks/main-14614ae8e939b9e5961e.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/framework.c7b20b4e446c7cca89e7.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/7945cc82.ff5578978733a40a67a3.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/commons.a32a113e095d8f0b1079.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/pages/_app-1832d2b05f1f19d6a06d.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/a1bc03cf.64f9f8493143216945e6.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/4d6c67b811e74d3ca6630b1db854b02fef4ff3ce.8a4303f940dd12850a8f.js" as="script"/><link rel="preload" href="/comparison-note/_next/static/chunks/pages/%5B...param%5D-ec17b069b047a5ce78c3.js" as="script"/></head><body><div id="__next"><nav class="navbar navbar-expand-lg navbar-light bg-light"><a href="/comparison-note/" class="navbar-brand">对比学习笔记</a><button aria-controls="basic-navbar-nav" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="basic-navbar-nav"><div class="mr-auto navbar-nav"><a href="/comparison-note/algorithm" data-rb-event-key="/algorithm" class="nav-link">数据结构和算法</a><a href="/comparison-note/basic-concept" data-rb-event-key="/basic-concept" class="nav-link">基础概念</a><a href="/comparison-note/data-type" data-rb-event-key="/data-type" class="nav-link">数据类型</a><a href="/comparison-note/special" data-rb-event-key="/special" class="nav-link">专题</a></div></div></nav><div style="padding-top:12px;padding-bottom:12px" class="container-fluid"><h1>信道</h1><div style="margin-bottom:12px"><div class="markdown-body"></div></div><div style="margin-bottom:12px" class="justify-content-md-center row"><div class="col-md-auto"><div role="toolbar" class="btn-toolbar"><div role="group" class="btn-group btn-group-sm btn-group-toggle"><label class="btn btn-secondary"><input type="checkbox" value="go" autoComplete="off"/>go</label></div></div></div></div><div class="card-group"></div><div style="margin-top:12px" class="card"><div class="card-body"><h6>了解更多</h6><ul><li><a href="/comparison-note/data-type/chanel/chanel-select/">信道选择</a><span style="color:#666"> [go]</span></li></ul></div></div></div><div style="text-align:center;padding:12px 0;font-size:14px">v<!-- -->0.1.0<!-- --> <a href="https://github.com/fishjar/comparison-note" title="访问github源码">github</a></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"nav":{"name":"chanel","fullPath":"/data-type/chanel","asPath":"/data-type/chanel","id":"%2Fdata-type%2Fchanel","parent":{"name":"data-type","fullPath":"/data-type","asPath":"/data-type","id":"%2Fdata-type","readme":{"title":"数据类型","fullPath":"/data-type/README.md"}},"readme":{"title":"信道","fullPath":"/data-type/chanel/README.md"},"cards":[{"name":"go.md","baseName":"go","extName":".md","fullPath":"/data-type/chanel/go.md"}],"nodes":[{"name":"chanel-select","fullPath":"/data-type/chanel/chanel-select","asPath":"/data-type/chanel/chanel-select","id":"%2Fdata-type%2Fchanel%2Fchanel-select","parent":{"name":"chanel","fullPath":"/data-type/chanel","asPath":"/data-type/chanel","id":"%2Fdata-type%2Fchanel","readme":{"title":"信道","fullPath":"/data-type/chanel/README.md"}},"readme":{"title":"信道选择","fullPath":"/data-type/chanel/chanel-select/README.md"},"cards":[{"name":"go.md","baseName":"go","extName":".md","fullPath":"/data-type/chanel/chanel-select/go.md"}],"nodes":[]}]},"content":"","cards":[{"name":"go.md","baseName":"go","extName":".md","fullPath":"/data-type/chanel/go.md","content":"信道是带有类型的管道，你可以通过它用信道操作符 `\u003c-` 来发送或者接收值。\n\n```go\nch \u003c- v    // 将 v 发送至信道 ch。\nv := \u003c-ch  // 从 ch 接收值并赋予 v。\nch := make(chan int) // 和映射与切片一样，信道在使用前必须创建：\n\n\npackage main\nimport \"fmt\"\nfunc sum(s []int, c chan int) {\n  sum := 0\n  for _, v := range s {\n    sum += v\n  }\n  c \u003c- sum // 将和送入 c\n}\nfunc main() {\n  s := []int{7, 2, 8, -9, 4, 0}\n  c := make(chan int)\n  go sum(s[:len(s)/2], c)\n  go sum(s[len(s)/2:], c)\n  x, y := \u003c-c, \u003c-c // 从 c 中接收\n  fmt.Println(x, y, x+y)\n}\n// -5 17 12\n\n\n// 将缓冲长度作为第二个参数提供给 make 来初始化一个带缓冲的信道：\n// 仅当信道的缓冲区填满后，向其发送数据时才会阻塞。\n// 当缓冲区为空时，接受方会阻塞。\npackage main\nimport \"fmt\"\nfunc main() {\n  ch := make(chan int, 2)\n  ch \u003c- 1\n  ch \u003c- 2\n  fmt.Println(\u003c-ch)\n  fmt.Println(\u003c-ch)\n}\n\n\n// 发送者可通过 close 关闭一个信道来表示没有需要发送的值了。\n// 若没有值可以接收且信道已被关闭\n// v, ok := \u003c-ch\n// ok 会被设置为 false。\n// 记住应该在生产者的地方关闭channel，而不是消费的地方去关闭它，这样容易引起panic\n// 另外记住一点的就是channel不像文件之类的，不需要经常去关闭，\n// 只有当你确实没有任何发送数据了，或者你想显式的结束range循环之类的\n\n// 循环 for i := range c 会不断从信道接收值，直到它被关闭。\n// *注意：* 只有发送者才能关闭信道，而接收者不能。\n// for i := range c能够不断的读取channel里面的数据，直到该channel被显式的关闭。\npackage main\nimport (\n  \"fmt\"\n)\nfunc fibonacci(n int, c chan int) {\n  x, y := 0, 1\n  for i := 0; i \u003c n; i++ {\n    c \u003c- x\n    x, y = y, x+y\n  }\n  close(c) // 关闭信道，不关闭会报错\n}\nfunc main() {\n  c := make(chan int, 10)\n  go fibonacci(cap(c), c)\n  for i := range c { // 循环信道，注意i就是信道保存值，而不是序号\n    fmt.Println(i)\n  }\n}\n// 0\n// 1\n// 1\n// 2\n// 3\n// 5\n// 8\n// 13\n// 21\n// 34\n\n\n\n\n// 练习：Web 爬虫\npackage main\nimport (\n  \"fmt\"\n)\n// 定义接口\ntype Fetcher interface {\n  // Fetch 返回 URL 的 body 内容，并且将在这个页面上找到的 URL 放到一个 slice 中。\n  Fetch(url string) (body string, urls []string, err error)\n}\n// fakeFetcher 是返回若干结果的 Fetcher。\ntype fakeFetcher map[string]*fakeResult\ntype fakeResult struct {\n  body string\n  urls []string\n}\n// 实现接口方法\nfunc (f fakeFetcher) Fetch(url string) (string, []string, error) {\n  if res, ok := f[url]; ok {\n    return res.body, res.urls, nil\n  }\n  return \"\", nil, fmt.Errorf(\"not found: %s\", url)\n}\n// fetcher 是填充后的 fakeFetcher。\nvar fetcher = fakeFetcher{\n  \"https://golang.org/\": \u0026fakeResult{\n    \"The Go Programming Language\",\n    []string{\n      \"https://golang.org/pkg/\",\n      \"https://golang.org/cmd/\",\n    },\n  },\n  \"https://golang.org/pkg/\": \u0026fakeResult{\n    \"Packages\",\n    []string{\n      \"https://golang.org/\",\n      \"https://golang.org/cmd/\",\n      \"https://golang.org/pkg/fmt/\",\n      \"https://golang.org/pkg/os/\",\n    },\n  },\n  \"https://golang.org/pkg/fmt/\": \u0026fakeResult{\n    \"Package fmt\",\n    []string{\n      \"https://golang.org/\",\n      \"https://golang.org/pkg/\",\n    },\n  },\n  \"https://golang.org/pkg/os/\": \u0026fakeResult{\n    \"Package os\",\n    []string{\n      \"https://golang.org/\",\n      \"https://golang.org/pkg/\",\n    },\n  },\n}\n// Crawl 使用 fetcher 从某个 URL 开始递归的爬取页面，直到达到最大深度。\nfunc Crawl(url string, depth int, fetcher Fetcher) {\n  // TODO: 并行的抓取 URL。\n  // TODO: 不重复抓取页面。\n        // 下面并没有实现上面两种情况：\n  if depth \u003c= 0 {\n    return\n  }\n  body, urls, err := fetcher.Fetch(url)\n  if err != nil {\n    fmt.Println(err)\n    return\n  }\n  fmt.Printf(\"found: %s %q\\n\", url, body)\n  for _, u := range urls {\n    Crawl(u, depth-1, fetcher)\n  }\n  return\n}\nfunc main() {\n  Crawl(\"https://golang.org/\", 4, fetcher)\n}\n```\n\n## 信道阻塞\n\n`ch := make(chan type, value)`\n\n- 当 `value = 0` 时，`channel` 是无缓冲阻塞读写的，\n- 当 `value \u003e 0` 时，`channel` 有缓冲、是非阻塞的，\n  直到写满 `value` 个元素才阻塞写入。\n\n- 如果一个 go 程写，一个 go 程读，不会阻塞报错\n- 如果同一个 go 程写+读，需要注意信道的缓冲大小\n\n```go\npackage main\nimport \"fmt\"\nfunc main() {\n  c := make(chan int, 2) //修改2为1就报错，修改2为3可以正常运行\n  c \u003c- 1\n  c \u003c- 2\n  fmt.Println(\u003c-c)\n  fmt.Println(\u003c-c)\n}\n\n\n// 亦会报错\npackage main\nimport \"fmt\"\nfunc main() {\n  c := make(chan int) // 想当于 c := make(chan int， 0)\n  c \u003c- 1 // 此处阻塞，无法执行，必须在另一个go程取出数据才会继续\n  c \u003c- 2\n  fmt.Println(\u003c-c)\n  fmt.Println(\u003c-c)\n}\n\n\n// 正确执行\npackage main\nimport \"fmt\"\nfunc main() {\n  c := make(chan int)\n  go func() { // 新开一个go程，向信道写入数据\n    c \u003c- 1\n    c \u003c- 2\n  }()\n  fmt.Println(\u003c-c) // 取出数据\n  fmt.Println(\u003c-c)\n}\n\n\n// package main\nimport \"fmt\"\nfunc main() {\n  ch := make(chan int, 2)\n  ch \u003c- 1\n  ch \u003c- 2\n  close(ch) // 这里不关闭将会报错\n  for i := range ch {\n    fmt.Println(i)\n  }\n}\n```\n\n## 信道关闭\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    jobs := make(chan int, 5)\n    done := make(chan bool)\n\n    go func() {\n        for {\n            j, more := \u003c-jobs\n            if more {\n                fmt.Println(\"received job\", j)\n            } else {\n                fmt.Println(\"received all jobs\")\n                done \u003c- true\n                return\n            }\n        }\n    }()\n\n    for j := 1; j \u003c= 3; j++ {\n        jobs \u003c- j\n        fmt.Println(\"sent job\", j)\n    }\n    close(jobs)\n    fmt.Println(\"sent all jobs\")\n\n    \u003c-done\n}\n```\n\n## 信道遍历\n\n一个非空的通道也是可以关闭的， 并且，通道中剩下的值仍然可以被接收到。\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\n    queue := make(chan string, 2)\n    queue \u003c- \"one\"\n    queue \u003c- \"two\"\n    close(queue)\n\n    for elem := range queue {\n        fmt.Println(elem)\n    }\n}\n```\n"}]}},"page":"/[...param]","query":{"param":["data-type","chanel"]},"buildId":"S-jJrz2DKYE9I2Mqo2Xou","assetPrefix":"/comparison-note","nextExport":true,"isFallback":false,"gip":true,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"charSet":"utf-8"}],["title",{"children":"信道"}]]}</script><script nomodule="" src="/comparison-note/_next/static/chunks/polyfills-7258ef49cf482e03ae9c.js"></script><script src="/comparison-note/_next/static/chunks/main-14614ae8e939b9e5961e.js" async=""></script><script src="/comparison-note/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/comparison-note/_next/static/chunks/framework.c7b20b4e446c7cca89e7.js" async=""></script><script src="/comparison-note/_next/static/chunks/7945cc82.ff5578978733a40a67a3.js" async=""></script><script src="/comparison-note/_next/static/chunks/commons.a32a113e095d8f0b1079.js" async=""></script><script src="/comparison-note/_next/static/chunks/pages/_app-1832d2b05f1f19d6a06d.js" async=""></script><script src="/comparison-note/_next/static/chunks/a1bc03cf.64f9f8493143216945e6.js" async=""></script><script src="/comparison-note/_next/static/chunks/4d6c67b811e74d3ca6630b1db854b02fef4ff3ce.8a4303f940dd12850a8f.js" async=""></script><script src="/comparison-note/_next/static/chunks/pages/%5B...param%5D-ec17b069b047a5ce78c3.js" async=""></script><script src="/comparison-note/_next/static/S-jJrz2DKYE9I2Mqo2Xou/_buildManifest.js" async=""></script><script src="/comparison-note/_next/static/S-jJrz2DKYE9I2Mqo2Xou/_ssgManifest.js" async=""></script></body></html>